---
title: TCP-IP
date: 2023-07-16 12:00:00 +0800
categories: [Redes y Telecomunicaciones, TCP-IP]
tags: [TCP-IP]
---

En este cap√≠tulo inicial se pretende ofrecer, necesariamente de una forma r√°pida y esquem√°tica, un resumen de los conocimientos previos m√≠nimos imprescindibles para abordar el resto del libro con garant√≠as. No es, por tanto, una exposici√≥n completa ni exhaustiva y debe tomarse como simple referencia de los conocimientos m√°s importantes que se dar√°n por supuesto de ahora en adelante.

Dado que se trata de un libro orientado fundamentalmente a cubrir las ense√±anzas del m√≥dulo **‚ÄúServicios de Red e Internet‚Äù** perteneciente al segundo curso del Ciclo Formativo de Grado Superior **‚ÄúAdministraci√≥n de Sistemas Inform√°ticos y Redes‚Äù** 1, se presupone que el lector/alumno conoce en menor o mayor medida diversos temas relacionados con la estructura y funcionamiento interno de la arquitectura de comunicaciones TCP/IP, modelo cliente/servidor y en general, posee conocimientos suficientes para configurar y administrar cuanto menos una peque√±a red de √°rea local.

Todo ello deber√≠a ser posible para el lector/alumno si ha cursado con anterioridad el m√≥dulo **‚ÄúPlanificaci√≥n y Administraci√≥n de Redes‚Äù** del primer curso del Ciclo Formativo mencionado anteriormente. Si esto es as√≠, este cap√≠tulo simplemente le servir√° de recordatorio de lo ya aprendido y le concretar√° aquellos elementos que debe tener claros para el resto de los cap√≠tulos.

Si no se parte de esta base inicial, el lector deber√° estudiar pausada y atentamente todo lo que en este cap√≠tulo se sintetiza con objeto de alcanzar las destrezas m√≠nimas necesarias para entender lo que sigue.

Es importante destacar que, asimismo, en este cap√≠tulo se realizara la configuraci√≥n inicial de la red virtual local basada en m√°quinas virtuales, la cual se utilizara a lo largo de los siguientes cap√≠tulos para poner en pr√°ctica los conocimientos te√≥ricos que vayan adquiri√©ndose.


*   **TCP/IP**
    *   Arquitectura TCP/IP, modelo Cliente/Servidor y servicios de red. [üîó](#arquitectura-tcpip-modelo-clienteservidor-y-servicios-de-red)
    *   Capa de red en TCP/IP - Protocolo IP. [üîó](#capa-de-red-en-tcpip---protocolo-ip)
    *   Capa de transporte en TCP/IP - Protocolos TCP y UDP. [üîó](#capa-de-transporte-en-tcpip---protocolos-tcp-y-udp)
    *   Traducci√≥n de direcciones de red - NAT. [üîó]()


## Arquitectura TCP/IP, modelo Cliente/Servidor y servicios de red.

Desde un principio, la arquitectura TCP/IP ha estado orientada a funcionar en un entorno
cliente/servidor, lo que ha facilitado enormemente la implantaci√≥n de diversos servicios de red
tanto en redes locales como en Internet.

###  La arquitectura TCP/IP y el modelo OSI

La arquitectura TCP/IP nos proporciona una estructura y una serie de normas de
funcionamiento para poder interconectar sistemas. La complejidad de esta tarea ha necesitado
una subdivisi√≥n del trabajo en niveles o capas.

En cada capa existen una serie de protocolos que ofrecen unas normas estrictas a seguir para
el di√°logo entre los sistemas. As√≠, por ejemplo, tenemos el protocolo IP en la capa de red, TCP y UDP en la capa de transporte, FTP y SNMP en la capa de aplicaci√≥n, etc.

![IMG](https://media.fs.com/images/community/upload/kindEditor/202106/08/diferencia-entre-modelo-osi-y-tcp-ip-1623136728-U2j39Uug7B.png)

### El modelo Cliente/Servidor

Para la comunicaci√≥n de aplicaciones a trav√©s de una red se emplean fundamentalmente tres
paradigmas:

*   **Cliente/Servidor**  En √©l se distingue entre un proceso cliente (que generalmente solicita servicios) y un proceso servidor (que presta el servicio al cliente).

*   **Entre Pares o P2P** Todos los nodos de la red son responsables por igual en la comunicaci√≥n de las aplicaciones, y no existe un elemento que centralice la comunicaci√≥n.

*   **H√≠brido** El servidor no presta el servicio como tal, sino que generalmente pone en contacto a los clientes.

El modelo Cliente/Servidor est√° formado por dos procesos que interact√∫an entre s√≠:

*   **Cliente** Env√≠a una petici√≥n a un proceso servidor y a continuaci√≥n queda a la espera de la respuesta.

*   **Servidor** Inicialmente, permanece a la espera escuchando las posibles conexiones de los potenciales clientes. Deben tenerse en cuenta en su dise√±o cuestiones como la autenticaci√≥n, autorizaci√≥n, seguridad y privacidad de la informaci√≥n.

![IMG](https://upload.wikimedia.org/wikipedia/commons/1/1c/Cliente-Servidor.png)

### Los servicios de red

Un servicio de red es, o puede considerarse, una funci√≥n o prestaci√≥n que ofrecen las
aplicaciones y los protocolos a los usuarios o a otras aplicaciones.

Es importante no confundir los protocolos del nivel de aplicaci√≥n con las aplicaciones que
los utilizan:

*   **Aplicaciones** Son los diferentes programas que se sirven de los protocolos de la arquitectura TCP/IP para comunicarse. Mozilla Thunderbird, Google Chrome...

*   **Protocolos** Son normas concretas, descritas formalmente, que detallan c√≥mo se produce
la comunicaci√≥n entre sistemas. IMAP, HTTP...

Ejemplos:

*   **Servicios Web**

    *   **Aplicaciones**

        *    Servidor: Apache, Nginx...
        
        *    Cliente: Mozilla Firefox, Google Chrome...

    *   **Protocolos** HTTP, HTTPS...

*   **Servicio de correo electr√≥nico**

    *   **Aplicaciones**

        *    Servidor: Sendmail, Postfix, Exchange...
        
        *    Cliente: Mozilla Thunderbird, Outlook, Sylepheed...

    *   **Protocolos** POP, SMTP, IMAP...



## Capa de red en TCP/IP - Protocolo IP.


A nivel de red se realiza el direccionamiento de los dispositivos y el encaminamiento de la informaci√≥n a trav√©s de la red. Todo ello se lleva a cabo con el protocolo IP, que es el principal de este nivel en la arquitectura TCP/IP. Actualmente, se emplea mayoritariamente la versi√≥n 4 del protocolo IP (IPv4), pero la versi√≥n siguiente IPv6 est√° desarrollada desde hace a√±os y empieza a implantarse.

### Direccionamiento IP

El protocolo IP proporciona conectividad extremo a extremo en la comunicaci√≥n. Esto supone que debe ser capaz de direccionar de forma √∫nica todos los dispositivos que tengamos conectados en nuestra red y, por extensi√≥n, en todo Internet.

Una direcci√≥n IP no identifica a un ordenador en la red, sino que identifica a una interfaz de red de un ordenador en la red. Por eso es posible que un mismo equipo pueda tener varias direcciones IP, una por interfaz.

### Formato de direcciones IP

Una direcci√≥n IP es un n√∫mero binario de 32 bits. Esto permite un espacio de direcciones de 2 32 (4.294.967.296) direcciones diferentes posibles, se dividen los 32 bits en 4 grupos de 8 bits.

![IMG](https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Ipv4_address_Spanish.svg/220px-Ipv4_address_Spanish.svg.png)

Las direcciones IP constan de dos partes:

*   **Identificador de Red** Determina la red en la que se encuentra el dispositivo.

*   **Identificador de Host** Identifica el host dentro de la red.


### M√°scara de red

La m√°scara de red se emplea para diferenciar el prefijo de la direcci√≥n IP correspondiente al identificador de red, de la parte correspondiente al identificador del host. La m√°scara de red es un n√∫mero de 32 bits que define en las posiciones a ‚Äú1‚Äù el prefijo o identificador de red, y en las posiciones a ‚Äú0‚Äù el sufijo o identificador del host.

![IMG](https://user-images.githubusercontent.com/67869168/199673175-d464c085-6506-493e-9112-e4e1f6ff7185.png)

### Direcciones especiales

Dentro del conjunto de direcciones IP hay algunas particularmente importantes que merecen una explicaci√≥n aparte:

*   **Direcci√≥n de Red** Identifica al conjunto de la red. En ella la parte correspondiente al identificador del dispositivo tiene todos sus bits a 0. (192.168.1.0)
*   **Direcci√≥n de difusi√≥n limitada** Se emplea para mandar un mensaje de difusi√≥n o broadcast al conjunto de dispositivos de la propia red.
*   **Direcci√≥n de difusi√≥n dirigida** Se emplea para mandar un mensaje de difusi√≥n o broadcast al conjunto de dispositivos de una red.
*   **Direcci√≥n de bucle local** Sirve para referenciar internamente a la interfaz, es decir, para los procesos de comunicaci√≥n a trav√©s de TCP/IP que se generan dentro del host. (127.0.0.1/8)

### Direcciones p√∫blicas

Identifican a un dispositivo conectado a Internet.

### Direcciones privadas

Son rangos de direcciones reservados para redes privadas o intranets y no pueden emplearse en Internet.

### Direcciones de enlace local

Hay un conjunto de direcciones reservado para ser asignado en redes que no dispongan de direccionamiento est√°tico ni din√°mico, es decir, son direcciones que se asignan los dispositivos a s√≠ mismos cuando nadie lo hace. (169.254.0.0/16)

### Encaminamiento IP

El encaminamiento a nivel IP puede definirse como el proceso de llevar un datagrama desde la m√°quina origen a la m√°quina destino.

### Encaminadores

Los encaminadores o routers son dispositivos de nivel 3 que enlazan las diferentes redes que forman parte de una ‚Äúred de redes‚Äú. Un router estar√° conectado al menos a dos redes y realizar√° el encaminamiento de todo el tr√°fico de datagramas que pase por √©l.

![IMG](https://user-images.githubusercontent.com/67869168/199672941-a1ff0d05-0c04-4162-b46c-ae98a1990a46.png)

### Tablas de encaminamiento

Las tablas de encaminamiento, almacenan la informaci√≥n necesaria para realizar el encaminamiento de los datagramas y est√°n implementadas tanto en los routers como en los hosts. Los campos m√°s importantes de los que consta son:


*   **Destino (D)** Direcci√≥n IP de una red u host.
*   **M√°scara de red (MR)** Determinar exactamente todas las direcciones IP que incluye.
*   **Direcci√≥n de salto (DS)** Direcci√≥n IP a la que se enviara el datagrama.
*   **Interfaz** Direcci√≥n IP del encaminador por la que hay que enviar el datagrama.

![IMG](https://user-images.githubusercontent.com/67869168/199673941-12d503f1-bdad-4e7d-a60b-52f36112607a.png)

### Protocolos de encaminamiento

*   **Encaminamiento est√°tico** La configuraci√≥n de las tablas de encaminamiento se hace de forma manual
*   **Encaminamiento din√°mico** El propio encaminador actualiza sus tablas gracias a la utilizaci√≥n de protocolos espec√≠ficos como RIP (Routing Information Protocol), OSP (Open Shortest Path First) y BGP (Border Gateway Protocol). 

## Capa de transporte en TCP/IP - Protocolos TCP y UDP.

Hasta ahora, hemos visto que el protocolo IP nos permite comunicar dos m√°quinas remotas haciendo que los datagramas puedan ir del origen al destino, pero al disponer √∫nicamente de las direcciones IP de origen y destino como mecanismo de diferenciaci√≥n en la comunicaci√≥n, se plantea el problema de que no nos permite, por ejemplo, mantener varias comunicaciones simult√°neas entre los dos mismos equipos, ya que a nivel IP no podr√≠amos diferenciar los datagramas pertenecientes a unas u otras.

El nivel de transporte nos provee de elementos para diferenciar y gestionar, de forma
simult√°nea, m√∫ltiples orƒ±ÃÅgenes y destinos en una comunicaci√≥n y m√∫ltiples comunicaciones en cada
equipo. 

### Puertos de comunicaciones

Cada proceso del nivel de aplicaci√≥n tiene asociado uno o varios puertos a trabes de los cuales es accesible. Cada puerto se identifica por un n√∫mero binario de 16 bits, 2^16 -1 = 65535.

Existen varias clases de puertos en funci√≥n del uso que se hace de ellos:

*   **0 - 1023** Se conocen como well known ports y est√°n reservados para aplicaciones y servicios est√°ndar como HTTP, FTP
*   **1024 - 49151** Para aplicaciones no est√°ndar instaladas por el usuario que no tienen un puerto well known preasignado.
*   **049152 - 65535** Habitualmente se emplean para iniciar conexiones desde el cliente.

La correspondencia entre procesos y puertos se hace de dos formas distintas:

*   **Asignaci√≥n Est√°tica** Los well known ports est√°n reservados para aplicaciones est√°ndar y solo pueden ser empleados por estos procesos
*   **Asignaci√≥n Din√°mica** Cada proceso necesita un puerto y este no se asigna de forma est√°tica.

### Protocolo UDP

El protocolo UDP (User Datagram Protocol) proporciona un servicio no orientado a conexi√≥n, sin establecimiento de conexi√≥n previo a la transmisi√≥n, son control de flujo.

Al tratarse de un protocolo muy b√°sico y con poca seguridad, se suele aplicar a conexiones en las que prevalece m√°s la velocidad que la fiabilidad

### Protocolo TCP

El protocolo TCP (Transmission Control Protocol) proporciona un servicio orientado a conexi√≥n con lo que existen diferencias respecto a UDP TCP, obliga a un establecimiento previo de un a conexi√≥n y a un control en el flujo de la comunicaci√≥n, por lo que prevalece la fiabilidad y no la velocidad.

### Conexiones TCP

La conexi√≥n TCP se define de forma √∫nica por los datos relativos a los puntos extremos de la comunicaci√≥n, es decir, por estos cuatro elementos: (Direcci√≥n IP origen, Puerto TCP origen) (Direcci√≥n IP destino, Puerto TCP destino). No puede haber dos conexiones TCP que tengan en com√∫n estos cuatro elementos.

## Traducci√≥n de direcciones de red - NAT.

El crecimiento exponencial del n√∫mero de ordenadores conectados a Internet y la consiguiente demanda de direcciones IP p√∫blicas ha provocado que el espacio de direcciones IP a√∫n disponible empiece a agotarse r√°pidamente.

La t√©cnica m√°s destacada en este sentido es la traducci√≥n de direcciones de red - NAT (Network Address Translation). NAT permite que direcciones IP privadas puedan acceder a Internet a trav√©s de una direcci√≥n IP p√∫blica.

![IMG](https://user-images.githubusercontent.com/67869168/199799268-7d70ee2a-c765-49dc-8cb2-e0a8c4093d9c.png)

### Funcionamiento

Para que el sistema NAT funcione es necesario que el encaminador que da acceso a Internet reescriba algunos datos en los datagramas que encamina. En funci√≥n de la informaci√≥n que se modifique tenemos varios tipos de NAT:

*   **NAT b√°sico** √önicamente se modifica la direcci√≥n IP (NAT a nivel de red).
*   **NAPT (Network Address Port Translation) / PAT (Port Address Translation)** Adem√°s de la direcci√≥n IP tambi√©n se modifican los puertos empleados en la comunicaci√≥n a nivel de transporte.

Se modifica la direcci√≥n IP de origen y el puerto de origen en el tr√°fico saliente de la red privada.

Se modifica la direcci√≥n IP de destino y el puerto de destino en el tr√°fico entrante en la red privada.

### Tr√°fico saliente

La idea fundamental aqu√≠ es que el encaminador que hace NAT sustituya la direcci√≥n IP de origen, privada, por la direcci√≥n IP p√∫blica del encaminador NAT, de forma que cuando el datagrama llegue a su destino parezca que el origen del mismo es el propio encaminador NAT.

### Respuesta al tr√°fico saliente

Cuando al encaminador NAT le llega un datagrama del exterior, comprueba si la direcci√≥n IP de destino y el puerto de destino del datagrama entrante coinciden con alg√∫n registro de su tabla NAT. Si es asƒ±ÃÅ (respuesta al tr√°fico saliente), quiere decir que se trata de una respuesta a un datagrama saliente anterior, y en este caso, el encaminador NAT cambiar√° en el datagrama entrante la direcci√≥n IP de destino y el puerto destino por la direcci√≥n IP interna, y el puerto interno de la entrada de la tabla NAT cuyos campos IP externa y Puerto externo coincidan con la direcci√≥n IP destino y puerto destino que trae el datagrama entrante.

![IMG](https://user-images.githubusercontent.com/67869168/199800310-b71aee1a-de72-44b4-956a-260db8ba7eb3.png)

### Soluciones al tr√°fico entrante nuevo - Redirecci√≥n de puertos

El hecho de descartar por defecto las conexiones entrantes puede suponer una gran limitaci√≥n en nuestra red interna, ya que si en ella disponemos de alg√∫n tipo de servidor, nos va a resultar imposible permitir que clientes de la red externa se conecten a nosotros. 

La redirecci√≥n de puertos (Port Forwarding) consiste en indicar al encaminador NAT una direcci√≥n IP de la red interna a la que redirigir todo el tr√°fico entrante nuevo. Para ello, deberemos a√±adir manualmente nuevas entradas en la tabla NAT que redirijan el tr√°fico entrante nuevo en funci√≥n del puerto al que vaya dirigido.

![IMG](https://user-images.githubusercontent.com/67869168/199801296-a99aa36e-3c82-4047-b0cd-6d28fff94751.png)